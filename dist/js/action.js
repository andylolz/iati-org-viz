var sendMessage=chrome.runtime.sendMessage;function isXML(e){var t=e.documentElement,n=t&&"http://www.w3.org/2000/svg"==t.namespaceURI;return!(e instanceof HTMLDocument||n)}function toXml(e){var t=(new DOMParser).parseFromString(e,"text/xml");if(t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName&&!t.getElementsByTagName("parsererror").length)return t;var n=t.getElementsByTagName("parsererror")[0];throw console.log(n),"<h2>Canâ€™t parse XML document</h2> \n"+(n?n.textContent:"")}function canTransform(e){return!!e&&(1==e.nodeType&&(e=e.ownerDocument),"documentElement"in e&&isXML(e)&&!(e.documentElement instanceof HTMLElement))}function doSomeMagic(e){console.log(e)}function doTransform(a){sendMessage({action:"xv.get-html",filePath:"html/html.html"},function(e){var t=(new DOMParser).parseFromString(e.fileText,"text/html");document.replaceChild(document.adoptNode(t.documentElement),document.documentElement),document.getElementsByTagName("link")[0].setAttribute("href",chrome.extension.getURL("css/css.css"));var n=document.implementation.createDocumentType("html","-//W3C//DTD XHTML 1.0 Transitional//EN","http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"),o=document.implementation.createDocument("http://www.w3.org/1999/xhtml","html",n),r=null;a instanceof Document?r=o.adoptNode(a.documentElement):(r=o.createDocumentFragment(),a.childNodes.forEach(function(e){r.appendChild(o.importNode(e,!0))})),o.replaceChild(r,o.documentElement),doSomeMagic(o)})}function togglePageAction(e){sendMessage({action:e?"xv.show-page-action":"xv.hide-page-action"})}"__canRender"in this||(this.__canRender=canTransform(document)),document.addEventListener("readystatechange",function(){if("complete"==document.readyState){var e=window.webkitIntent||window.intent;if(e){var t=e.getExtra?e.getExtra("url"):e.data[0].url;if(!t)return;return renderPage(t),void togglePageAction(!1)}var n=document&&document.getElementById("webkit-xml-viewer-source-xml");n?(n.parentNode.removeChild(n),doTransform(n),togglePageAction(!1)):__canRender?(renderPage(),togglePageAction(!1)):togglePageAction(!0)}});